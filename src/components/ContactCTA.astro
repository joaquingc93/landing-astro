---
// Contact CTA component with form integration
---

<section class="py-20 bg-gradient-to-br from-primary-600 via-primary-700 to-primary-800 relative overflow-hidden">
  
  <!-- Background Pattern -->
  <div class="absolute inset-0 opacity-10">
    <svg width="60" height="60" viewBox="0 0 60 60" class="w-full h-full">
      <defs>
        <pattern id="contact-grid" width="60" height="60" patternUnits="userSpaceOnUse">
          <path d="m 60,0 L 0,0 0,60" fill="none" stroke="white" stroke-width="1"/>
        </pattern>
      </defs>
      <rect width="100%" height="100%" fill="url(#contact-grid)" />
    </svg>
  </div>
  
  <!-- Floating Elements -->
  <div class="absolute top-20 left-20 w-32 h-32 bg-secondary-400/20 rounded-full animate-pulse-slow hidden lg:block"></div>
  <div class="absolute bottom-20 right-20 w-24 h-24 bg-white/10 rounded-full animate-pulse-slow animation-delay-1000 hidden lg:block"></div>
  
  <div class="container relative z-10">
    <div class="grid lg:grid-cols-2 gap-16 items-center">
      
      <!-- Content Side -->
      <div class="text-white">
        <div class="mb-6">
          <span class="inline-flex items-center px-4 py-2 bg-white/10 backdrop-blur-sm rounded-full text-sm font-medium text-primary-100 border border-white/20">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
            Get Started Today
          </span>
        </div>
        
        <h2 class="text-4xl lg:text-5xl font-bold mb-6 animate-on-scroll">
          Ready to Transform 
          <span class="block text-secondary-400">Your Space?</span>
        </h2>
        
        <p class="text-xl text-primary-100 mb-8 leading-relaxed animate-on-scroll">
          Get a free, no-obligation consultation and detailed estimate for your remodeling project. 
          Our certified experts are ready to bring your vision to life.
        </p>
        
        <!-- Benefits List -->
        <div class="space-y-4 mb-8">
          <div class="flex items-center gap-3 animate-on-scroll">
            <div class="flex-shrink-0">
              <svg class="w-6 h-6 text-secondary-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
              </svg>
            </div>
            <span class="text-lg">Free detailed consultation & estimate</span>
          </div>
          
          <div class="flex items-center gap-3 animate-on-scroll">
            <div class="flex-shrink-0">
              <svg class="w-6 h-6 text-secondary-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
              </svg>
            </div>
            <span class="text-lg">Licensed & certified professionals</span>
          </div>
          
          <div class="flex items-center gap-3 animate-on-scroll">
            <div class="flex-shrink-0">
              <svg class="w-6 h-6 text-secondary-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
              </svg>
            </div>
            <span class="text-lg">Quality guarantee on all work</span>
          </div>
          
          <div class="flex items-center gap-3 animate-on-scroll">
            <div class="flex-shrink-0">
              <svg class="w-6 h-6 text-secondary-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
              </svg>
            </div>
            <span class="text-lg">Flexible financing options available</span>
          </div>
        </div>
      </div>
      
      <!-- Form Side -->
      <div class="bg-white rounded-2xl shadow-2xl p-8 animate-on-scroll">
        <div class="mb-6">
          <h3 class="text-2xl font-bold text-neutral-900 mb-2">Get Your Free Estimate</h3>
          <p class="text-neutral-600">Fill out the form below and we'll get back to you within 24 hours.</p>
        </div>
        
        <form id="contact-form" class="space-y-6" novalidate>
          <!-- Name -->
          <div>
            <label for="name" class="block text-sm font-medium text-neutral-700 mb-2">
              Full Name *
            </label>
            <input 
              type="text" 
              id="name" 
              name="name" 
              required
              class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200"
              placeholder="Your full name"
            />
            <div class="error-message hidden text-red-600 text-sm mt-1"></div>
          </div>
          
          <!-- Email -->
          <div>
            <label for="email" class="block text-sm font-medium text-neutral-700 mb-2">
              Email Address *
            </label>
            <input 
              type="email" 
              id="email" 
              name="email" 
              required
              class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200"
              placeholder="your@email.com"
            />
            <div class="error-message hidden text-red-600 text-sm mt-1"></div>
          </div>
          
          <!-- Phone -->
          <div>
            <label for="phone" class="block text-sm font-medium text-neutral-700 mb-2">
              Phone Number *
            </label>
            <input 
              type="tel" 
              id="phone" 
              name="phone" 
              required
              class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200"
              placeholder="(305) XXX-XXXX"
            />
            <div class="error-message hidden text-red-600 text-sm mt-1"></div>
          </div>
          
          <!-- Service Type -->
          <div>
            <label for="service" class="block text-sm font-medium text-neutral-700 mb-2">
              Service Interested In *
            </label>
            <select 
              id="service" 
              name="service" 
              required
              class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200"
            >
              <option value="">Select a service...</option>
              <option value="pool">Pool Remodeling</option>
              <option value="concrete">Concrete & Flooring</option>
              <option value="cleaning">Residential Cleaning</option>
              <option value="technical">Technical Support & Plans</option>
              <option value="other">Other / Multiple Services</option>
            </select>
            <div class="error-message hidden text-red-600 text-sm mt-1"></div>
          </div>
          
          <!-- Project Timeline -->
          <div>
            <label for="timeline" class="block text-sm font-medium text-neutral-700 mb-2">
              Project Timeline
            </label>
            <select 
              id="timeline" 
              name="timeline"
              class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200"
            >
              <option value="immediate">As soon as possible</option>
              <option value="1-3-months">1-3 months</option>
              <option value="3-6-months">3-6 months</option>
              <option value="planning">Still planning</option>
            </select>
          </div>
          
          <!-- Message -->
          <div>
            <label for="message" class="block text-sm font-medium text-neutral-700 mb-2">
              Project Details *
            </label>
            <textarea 
              id="message" 
              name="message" 
              rows="4" 
              required
              class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors duration-200 resize-none"
              placeholder="Please describe your project, including size, specific requirements, and any questions you have..."
            ></textarea>
            <div class="error-message hidden text-red-600 text-sm mt-1"></div>
          </div>
          
          <!-- Preferred Contact Method -->
          <div>
            <label class="block text-sm font-medium text-neutral-700 mb-3">
              Preferred Contact Method
            </label>
            <div class="flex gap-6">
              <label class="flex items-center">
                <input 
                  type="radio" 
                  name="preferred_contact" 
                  value="phone" 
                  class="text-primary-600 focus:ring-primary-500"
                  checked
                />
                <span class="ml-2 text-sm text-neutral-700">Phone</span>
              </label>
              <label class="flex items-center">
                <input 
                  type="radio" 
                  name="preferred_contact" 
                  value="email" 
                  class="text-primary-600 focus:ring-primary-500"
                />
                <span class="ml-2 text-sm text-neutral-700">Email</span>
              </label>
            </div>
          </div>
          
          <!-- Submit Button -->
          <button 
            type="submit" 
            class="w-full bg-primary-600 hover:bg-primary-700 text-white font-semibold py-4 px-6 rounded-lg transition-all duration-300 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
            id="submit-btn"
          >
            <span class="submit-text">Get My Free Estimate</span>
            <span class="loading-text hidden">Sending...</span>
          </button>
          
          <!-- Success/Error Messages -->
          <div id="form-success" class="hidden bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg">
            <div class="flex items-center">
              <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
              </svg>
              <div>
                <p class="font-semibold">Thank you for your message!</p>
                <p class="text-sm">We'll get back to you within 24 hours with your free estimate.</p>
              </div>
            </div>
          </div>
          
          <div id="form-error" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">
            <div class="flex items-center">
              <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
              </svg>
              <div>
                <p class="font-semibold">There was an error sending your message.</p>
                <p class="text-sm">Please try again or call us directly at (305) XXX-XXXX.</p>
              </div>
            </div>
          </div>
          
          <!-- Privacy Notice -->
          <p class="text-xs text-neutral-500 text-center">
            By submitting this form, you agree to our privacy policy. We respect your privacy and never share your information.
          </p>
        </form>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contact-form') as HTMLFormElement | null;
    const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement | null;
    const submitText = submitBtn?.querySelector('.submit-text') as HTMLElement | null;
    const loadingText = submitBtn?.querySelector('.loading-text') as HTMLElement | null;
    const successMessage = document.getElementById('form-success') as HTMLElement | null;
    const errorMessage = document.getElementById('form-error') as HTMLElement | null;
    
    // Form validation
    function validateField(field: HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement) {
      const errorElement = field.parentElement?.querySelector('.error-message') as HTMLElement | null;
      let isValid = true;
      let message = '';
      
      // Reset previous error state
      field.classList.remove('border-red-500');
      errorElement?.classList.add('hidden');
      
      // Check if required field is empty
      if (field.hasAttribute('required') && !field.value.trim()) {
        isValid = false;
        message = 'This field is required.';
      }
      
      // Email validation
      if (field.type === 'email' && field.value) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(field.value)) {
          isValid = false;
          message = 'Please enter a valid email address.';
        }
      }
      
      // Phone validation
      if (field.type === 'tel' && field.value) {
        const phoneRegex = /^[\d\s\-\(\)]+$/;
        if (!phoneRegex.test(field.value) || field.value.replace(/\D/g, '').length < 10) {
          isValid = false;
          message = 'Please enter a valid phone number.';
        }
      }
      
      // Message length validation
      if (field.name === 'message' && field.value.trim().length < 10) {
        isValid = false;
        message = 'Please provide at least 10 characters describing your project.';
      }
      
      // Show error if not valid
      if (!isValid) {
        field.classList.add('border-red-500');
        if (errorElement) {
          errorElement.textContent = message;
          errorElement.classList.remove('hidden');
        }
      }
      
      return isValid;
    }
    
    // Real-time validation on blur
    form?.addEventListener('blur', (e) => {
      if (e.target && (e.target as Element).matches('input, select, textarea')) {
        validateField(e.target as HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement);
      }
    }, true);
    
    // Phone number formatting
    const phoneInput = document.getElementById('phone') as HTMLInputElement;
    phoneInput?.addEventListener('input', (e) => {
      const target = e.target as HTMLInputElement;
      let value = target.value.replace(/\D/g, '');
      if (value.length >= 6) {
        value = `(${value.slice(0, 3)}) ${value.slice(3, 6)}-${value.slice(6, 10)}`;
      } else if (value.length >= 3) {
        value = `(${value.slice(0, 3)}) ${value.slice(3)}`;
      }
      target.value = value;
    });
    
    // Form submission
    form?.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Validate all required fields
      const requiredFields = form.querySelectorAll('[required]');
      let isFormValid = true;
      
      requiredFields.forEach(field => {
        if (!validateField(field as HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement)) {
          isFormValid = false;
        }
      });
      
      if (!isFormValid) {
        return;
      }
      
      // Show loading state
      if (submitBtn) {
        submitBtn.disabled = true;
        submitText?.classList.add('hidden');
        loadingText?.classList.remove('hidden');
      }
      
      // Hide previous messages
      successMessage?.classList.add('hidden');
      errorMessage?.classList.add('hidden');
      
      try {
        // Collect form data
        const formData = new FormData(form!);
        
        // Send data using API endpoint
        const response = await fetch('/api/contact', {
          method: 'POST',
          body: formData,
        });
        
        const result = await response.json();
        
        if (result.success) {
          successMessage?.classList.remove('hidden');
          form?.reset();
          
          // Track conversion (optional - integrate with your analytics)
          if (typeof (window as any).gtag !== 'undefined') {
            (window as any).gtag('event', 'conversion', {
              'send_to': 'AW-XXXXXXXXX/XXXXXXXXX',
              'value': 1.0,
              'currency': 'USD'
            });
          }
        } else {
          throw new Error(result.message || 'Submission failed');
        }
        
      } catch (error) {
        console.error('Form submission error:', error);
        errorMessage?.classList.remove('hidden');
      } finally {
        // Reset button state
        if (submitBtn) {
          submitBtn.disabled = false;
          submitText?.classList.remove('hidden');
          loadingText?.classList.add('hidden');
        }
      }
    });
    
    // Auto-resize textarea
    const messageTextarea = document.getElementById('message') as HTMLTextAreaElement | null;
    messageTextarea?.addEventListener('input', () => {
      messageTextarea.style.height = 'auto';
      messageTextarea.style.height = messageTextarea.scrollHeight + 'px';
    });
  });
</script>

<style>
  @keyframes pulse-slow {
    0%, 100% { opacity: 0.2; transform: scale(1); }
    50% { opacity: 0.4; transform: scale(1.05); }
  }
  
  .animate-pulse-slow {
    animation: pulse-slow 4s ease-in-out infinite;
  }
  
  .animation-delay-1000 { 
    animation-delay: 1s; 
  }
  
  /* Form enhancements */
  input:focus, select:focus, textarea:focus {
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
  }
  
  /* Loading spinner for button */
  .loading-text::after {
    content: '';
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid #ffffff;
    border-radius: 50%;
    border-top-color: transparent;
    animation: spin 1s linear infinite;
    margin-left: 8px;
    vertical-align: middle;
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  
  /* Accessibility improvements */
  @media (prefers-reduced-motion: reduce) {
    .animate-pulse-slow,
    .loading-text::after {
      animation: none;
    }
  }
  
  /* Performance optimizations */
  .container {
    contain: layout style;
  }
</style>